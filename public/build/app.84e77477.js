"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[524],{563(){function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return a(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var s=0,i=function(){};return{s:i,n:function(){return s>=t.length?{done:!0}:{done:!1,value:t[s++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,o=!0,c=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return o=t.done,t},e:function(t){c=!0,r=t},f:function(){try{o||null==n.return||n.return()}finally{if(c)throw r}}}}function a(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,n=Array(e);a<e;a++)n[a]=t[a];return n}function n(t,e){for(var a=0;a<e.length;a++){var n=e[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,s(n.key),n)}}function s(e){var a=function(e,a){if("object"!=t(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var s=n.call(e,a||"default");if("object"!=t(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===a?String:Number)(e)}(e,"string");return"symbol"==t(a)?a:a+""}var i=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.container=e,this.logs=[],this.currentIndex=0,this.isPlaying=!1,this.isPaused=!1,this.speed=1,this.characterElements={},this.characterMaxHP={},this.init()},a=[{key:"init",value:function(){var t=this,e=this.container.dataset.combatLogs;if(e)try{this.logs=JSON.parse(e),console.log("ðŸ“‹ Logs chargÃ©s:",this.logs.length,"entrÃ©es");var a=this.logs.find(function(t){return"attack"===t.type});a&&console.log("ðŸ“Œ Exemple de log d'attaque:",a)}catch(t){return void console.error("âŒ Erreur parsing logs:",t)}this.logContainer=this.container.querySelector("[data-combat-log]"),this.overlay=this.container.querySelector("[data-combat-overlay]"),this.playBtn=this.container.querySelector("[data-combat-play]"),this.skipBtn=this.container.querySelector("[data-combat-skip]"),this.speedBtns=this.container.querySelectorAll("[data-combat-speed]"),this.characterMaxHP={},this.container.querySelectorAll("[data-character-name]").forEach(function(e){var a=e.dataset.characterName,n=e.dataset.characterTeam,s="".concat(n,"-").concat(a);t.characterElements[s]=e;var i=e.querySelector(".hp-text");if(i){var r=i.textContent.match(/(\d+)\/(\d+)/);r&&(t.characterMaxHP[s]=parseInt(r[2]))}}),console.log("ðŸ‘¥ Personnages chargÃ©s:",Object.keys(this.characterElements)),console.log("ðŸ’š HP max:",this.characterMaxHP),this.overlay&&(this.overlay.style.display="none",this.overlay.style.opacity="0"),this.logContainer&&(this.logContainer.innerHTML=""),this.bindEvents(),setTimeout(function(){return t.play()},800)}},{key:"bindEvents",value:function(){var t=this;this.playBtn&&this.playBtn.addEventListener("click",function(){return t.togglePlay()}),this.skipBtn&&this.skipBtn.addEventListener("click",function(){return t.skip()}),this.speedBtns.forEach(function(e){e.addEventListener("click",function(e){return t.setSpeed(e)})})}},{key:"play",value:function(){this.isPlaying&&!this.isPaused||(this.isPlaying=!0,this.isPaused=!1,this.updatePlayButton(),this.processNextLog())}},{key:"pause",value:function(){this.isPaused=!0,this.updatePlayButton()}},{key:"togglePlay",value:function(){!this.isPlaying||this.isPaused?this.play():this.pause()}},{key:"skip",value:function(){for(this.isPlaying=!1,this.isPaused=!1;this.currentIndex<this.logs.length;){var t=this.logs[this.currentIndex];this.displayLog(t),this.updateHealthBars(t),"death"===t.type&&this.animateDeath(t.target,t.targetTeam),this.currentIndex++}this.showVictoryOverlay(),this.updatePlayButton()}},{key:"setSpeed",value:function(t){var e=parseFloat(t.currentTarget.dataset.combatSpeed);this.speed=e,this.speedBtns.forEach(function(t){return t.classList.remove("active")}),t.currentTarget.classList.add("active")}},{key:"processNextLog",value:function(){var t=this;if(this.isPlaying&&!this.isPaused){if(this.currentIndex>=this.logs.length)return this.isPlaying=!1,this.showVictoryOverlay(),void this.updatePlayButton();var e=this.logs[this.currentIndex];this.processLog(e),this.currentIndex++;var a=this.getDelayForLog(e);a/=this.speed,setTimeout(function(){return t.processNextLog()},a)}}},{key:"getDelayForLog",value:function(t){switch(t.type){case"round":case"attack":return 2e3;case"initiative":return 400;case"heal":return 1800;case"defend":case"protect":return 1500;case"dodge":return 1200;case"death":return 2500;case"victory":case"draw":return 1e3;default:return 800}}},{key:"processLog",value:function(t){var e=this;this.playAnimation(t),this.displayLog(t);var a=this.getHPUpdateDelay(t);a>0?setTimeout(function(){return e.updateHealthBars(t)},a/this.speed):this.updateHealthBars(t)}},{key:"getHPUpdateDelay",value:function(t){switch(t.type){case"attack":return 350;case"heal":return 400;default:return 0}}},{key:"playAnimation",value:function(t){switch(t.type){case"attack":this.animateAttack(t.attacker,t.attackerTeam,t.target,t.targetTeam,t.isCrit);break;case"heal":this.animateHeal(t.healer,t.healerTeam,t.target,t.targetTeam);break;case"defend":this.animateDefend(t.defender,t.defenderTeam);break;case"dodge":this.animateDodge(t.target,t.targetTeam);break;case"death":this.animateDeath(t.target,t.targetTeam)}}},{key:"animateAttack",value:function(t,e,a,n,s){var i=this.getCharacterElement(t,e),r=this.getCharacterElement(a,n);i&&(i.classList.add("attacking"),setTimeout(function(){return i.classList.remove("attacking")},600)),r&&setTimeout(function(){r.classList.add("hurt"),s&&r.classList.add("crit"),setTimeout(function(){return r.classList.remove("hurt","crit")},400)},300)}},{key:"animateHeal",value:function(t,e,a,n){var s=this.getCharacterElement(t,e),i=this.getCharacterElement(a,n);s&&(s.classList.add("healing"),setTimeout(function(){return s.classList.remove("healing")},800)),i&&(i.classList.add("healed"),setTimeout(function(){return i.classList.remove("healed")},800))}},{key:"animateDefend",value:function(t,e){var a=this.getCharacterElement(t,e);a&&(a.classList.add("defending"),setTimeout(function(){return a.classList.remove("defending")},1e3))}},{key:"animateDodge",value:function(t,e){var a=this.getCharacterElement(t,e);a&&(a.classList.add("dodging"),setTimeout(function(){return a.classList.remove("dodging")},600))}},{key:"animateDeath",value:function(t,e){var a=this.getCharacterElement(t,e);a&&a.classList.add("dead")}},{key:"getCharacterElement",value:function(t,e){return this.characterElements["".concat(e,"-").concat(t)]}},{key:"displayLog",value:function(t){if(this.logContainer){var e=document.createElement("p");e.className="combat-log__entry","round"===t.type?e.classList.add("combat-log__entry--round"):"victory"===t.type?e.classList.add("combat-log__entry--victory"):"draw"===t.type&&e.classList.add("combat-log__entry--defeat"),e.innerHTML=t.message,this.logContainer.appendChild(e),this.logContainer.scrollTop=this.logContainer.scrollHeight}}},{key:"updateHealthBars",value:function(t){var e=null,a=null,n=null,s=null;"attack"===t.type?(e=t.target,a=t.targetTeam,n=t.targetHP,s=t.targetMaxHP,console.log("Attack detected - HP update:",e,a,n,"/",s)):"heal"===t.type&&(e=t.target,a=t.targetTeam,n=t.targetHP,s=t.targetMaxHP,console.log("Heal detected - HP update:",e,a,n,"/",s)),e&&a&&null!=n&&s&&this.updateCharacterHP(e,a,n,s)}},{key:"updateCharacterHP",value:function(t,e,a,n){var s=this.getCharacterElement(t,e);if(s){var i=n>0?a/n*100:0,r=s.querySelector(".hp-bar__fill"),o=s.querySelector(".hp-text");r&&(r.style.transition="width 0.3s ease-out",r.style.width="".concat(i,"%"),r.classList.remove("hp-bar__fill--low","hp-bar__fill--critical"),i<=25?r.classList.add("hp-bar__fill--critical"):i<=50&&r.classList.add("hp-bar__fill--low")),o&&(o.textContent="".concat(a,"/").concat(n)),this.updateInfoPanel(t,e,a)}else console.error("âŒ Character element not found for:",t,"in team:",e)}},{key:"updateInfoPanel",value:function(t,a,n){var s="Equipe 1"===a?".info-panel--team1":".info-panel--team2",i=this.container.querySelector(s);if(i){var r,o=e(i.querySelectorAll(".character-info"));try{var c=function(){var e=r.value,a=e.querySelector(".character-info__name");if(a&&a.textContent.trim()===t){var s=e.querySelector(".character-info__stats span");return s&&(s.textContent=n,s.classList.add("hp-updated"),setTimeout(function(){return s.classList.remove("hp-updated")},300)),1}};for(o.s();!(r=o.n()).done&&!c(););}catch(t){o.e(t)}finally{o.f()}}}},{key:"showVictoryOverlay",value:function(){var t=this;this.overlay&&(this.overlay.style.display="flex",setTimeout(function(){t.overlay.style.opacity="1"},50)),this.finalizeRating()}},{key:"finalizeRating",value:function(){var t=this,e=this.container.dataset.finalizeUrl;e&&fetch(e,{method:"POST",headers:{"X-Requested-With":"XMLHttpRequest"}}).then(function(t){return t.json()}).then(function(e){e.success&&0!==e.ratingChange&&t.showRatingUpdate(e.ratingChange,e.newRating)}).catch(function(t){return console.error("Erreur finalisation rating:",t)})}},{key:"showRatingUpdate",value:function(t,e){var a=this.container.querySelector(".info-panel--team1 .info-panel__rating");a&&null!==e&&(a.innerHTML='<i class="fas fa-trophy"></i> '.concat(e," MMR"));var n=this.container.querySelector("[data-combat-overlay]");if(n){var s=document.createElement("div");s.className="rating-change",s.style.cssText="font-size:1.4rem;margin-top:12px;font-weight:bold;opacity:0;transition:opacity 0.5s;",s.textContent=t>0?"+".concat(t," MMR"):"".concat(t," MMR"),s.style.color=t>0?"#4caf50":"#f44336",n.querySelector(".battle-stage__winner").appendChild(s),setTimeout(function(){s.style.opacity="1"},100)}}},{key:"updatePlayButton",value:function(){this.playBtn&&(this.isPlaying&&!this.isPaused?this.playBtn.textContent="Pause":this.currentIndex>=this.logs.length?(this.playBtn.textContent="TerminÃ©",this.playBtn.disabled=!0):this.playBtn.textContent=this.currentIndex>0?"Reprendre":"Lancer")}}],a&&n(t.prototype,a),s&&n(t,s),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,a,s}();document.addEventListener("DOMContentLoaded",function(){var t=document.querySelector("[data-combat-logs]");t&&(console.log("Initialisation du combat..."),new i(t))});document.addEventListener("DOMContentLoaded",function(){var t=document.querySelector(".burger"),e=document.querySelector(".main-navigation");t&&e&&t.addEventListener("click",function(){e.classList.toggle("active")})});var r=100,o=100,c=100,l=100,u=200;document.addEventListener("DOMContentLoaded",function(){var t=document.querySelectorAll(".team-portrait"),e=document.getElementById("teamDetails"),a=document.querySelector(".selected-list"),n=document.querySelector(".btn-launch");if(e&&0!==t.length){var s=[],i=[],d={Tank:"Tank",DPS:"DPS",Support:"Support",Soigneur:"Support",Buffer:"Support"};t.forEach(function(h){h.addEventListener("click",function(){t.forEach(function(t){return t.classList.remove("active")}),h.classList.add("active");var v=h.dataset.id,y=h.dataset.name,m=h.dataset.role,g=Number(h.dataset.dmgMin),_=Number(h.dataset.dmgMax),b=Number(h.dataset.speed),L=Number(h.dataset.dodge),k=Number(h.dataset.crit),S=Number(h.dataset.hp),P=h.dataset.sprite,T="/asset/sprites/".concat(P),C=i.includes(v);e.innerHTML='\n                <div class="team-details-content">\n                    <h2>'.concat(y,'</h2>\n                    <p class="role">').concat(m,'</p>\n\n                    <div class="gif-container">\n                        <img src="').concat(T,'" alt="Sprite de ').concat(y,'">\n                    </div>\n\n                    <div class="stats">\n                        <div class="stat">\n                            <span>DMG</span>\n                            <div class="stat-bar">\n                                <div class="stat-fill"\n                                    style="width:').concat(Math.min(_/r*100,100),'%">\n                                </div>\n                            </div>\n                            <span>').concat(g," - ").concat(_,'</span>\n                        </div>\n\n                        <div class="stat">\n                            <span>VIT</span>\n                            <div class="stat-bar">\n                                <div class="stat-fill"\n                                    style="width:').concat(Math.min(b/o*100,100),'%">\n                                </div>\n                            </div>\n                            <span>').concat(b,'</span>\n                        </div>\n\n                        <div class="stat">\n                            <span>DODGE</span>\n                            <div class="stat-bar">\n                                <div class="stat-fill"\n                                    style="width:').concat(Math.min(L/c*100,100),'%">\n                                </div>\n                            </div>\n                            <span>').concat(L,'</span>\n                        </div>\n\n                        <div class="stat">\n                            <span>CRIT</span>\n                            <div class="stat-bar">\n                                <div class="stat-fill"\n                                    style="width:').concat(Math.min(k/l*100,100),'%">\n                                </div>\n                            </div>\n                            <span>').concat(k,'</span>\n                        </div>\n\n                        <div class="stat">\n                            <span>HP</span>\n                            <div class="stat-bar">\n                                <div class="stat-fill"\n                                    style="width:').concat(Math.min(S/u*100,100),'%">\n                                </div>\n                            </div>\n                            <span>').concat(S,'</span>\n                        </div>\n                    </div>\n\n                    <button class="btn-select-right">\n                        ').concat(C?"DÃ©sÃ©lectionner":"SÃ©lectionner","\n                    </button>\n                </div>\n            ");var E=e.querySelector(".btn-select-right"),w=d[m]||"Support";i.includes(v)||f(m)||(E.disabled=!0,E.textContent="Slot ".concat(w," dÃ©jÃ  pris")),E.addEventListener("click",function(){if(i.includes(v))i=i.filter(function(t){return t!==v}),s=s.filter(function(t){return t!==y}),h.classList.remove("selected");else{if(!f(m))return void alert("Vous avez dÃ©jÃ  un ".concat(w," dans votre Ã©quipe !"));if(i.length>=3)return void alert("Vous pouvez sÃ©lectionner maximum 3 personnages !");i.push(v),s.push(y),h.classList.add("selected")}!function(){if(a.innerHTML="",i.forEach(function(e){var n=Array.from(t).find(function(t){return t.dataset.id===e});if(n){var s=n.dataset.name,i="/asset/sprites/".concat(n.dataset.sprite),r=document.createElement("div");r.classList.add("selected-hero-sprite"),r.innerHTML='\n                <img src="'.concat(i,'" alt="Sprite de ').concat(s,'">\n                <span>').concat(s,"</span>\n            "),a.appendChild(r)}}),function(){var t=p(),e=document.querySelector(".role-indicator");e&&e.querySelectorAll(".role-slot").forEach(function(e){var a=e.dataset.role;1===t[a]?e.classList.add("filled"):e.classList.remove("filled")})}(),n){var e=p(),s=1===e.Tank&&1===e.DPS&&1===e.Support;n.disabled=!s}}(),E.textContent=i.includes(v)?"DÃ©sÃ©lectionner":"SÃ©lectionner",E.disabled=!1})})}),n&&n.addEventListener("click",function(){i.length>0&&fetch("/teams/select",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"},body:i.map(function(t,e){return"character_ids[".concat(e,"]=").concat(encodeURIComponent(t))}).join("&")}).then(function(t){t.redirected?window.location.href=t.url:window.location.href="/matchmaking"}).catch(function(){alert("Erreur lors de la sÃ©lection de l'Ã©quipe.")})})}function p(){var e={Tank:0,DPS:0,Support:0};return i.forEach(function(a){var n=Array.from(t).find(function(t){return t.dataset.id===a});if(n){var s=d[n.dataset.role]||"Support";e[s]++}}),e}function f(t){var e=d[t]||"Support";return p()[e]<1}}),document.addEventListener("DOMContentLoaded",function(){var t=document.querySelector("[data-profile-toggle]"),e=document.querySelector("[data-profile-popup]"),a=document.querySelector("[data-profile-backdrop]"),n=document.querySelector("[data-profile-close]"),s=document.querySelector("[data-profile-content]");if(t&&e){var i=!1;t.addEventListener("click",function(){e.style.display="block",a.style.display="block",e.offsetHeight,e.classList.add("profile-popup--open"),a.classList.add("profile-popup__backdrop--open"),i||fetch("/api/profile").then(function(t){return t.json()}).then(function(t){i=!0,function(t){var e=function(t){return"win"===t?"result--win":"loss"===t?"result--loss":"result--draw"},a=function(t){return"win"===t?"Victoire":"loss"===t?"DÃ©faite":"Nul"},n=t.profileImage?'<img src="'.concat(t.profileImage,'" alt="Avatar">'):'<i class="fas fa-user-circle"></i>',i='\n            <div class="profile-popup__identity">\n                <div class="profile-popup__avatar">'.concat(n,'</div>\n                <div class="profile-popup__info">\n                    <span class="profile-popup__username">').concat(t.username,"</span>\n                    ").concat(t.motto?'<span class="profile-popup__motto">Â« '.concat(t.motto," Â»</span>"):"","\n                    ").concat(t.bio?'<p class="profile-popup__bio">'.concat(t.bio,"</p>"):"",'\n                </div>\n            </div>\n\n            <div class="profile-popup__stats">\n                <div class="profile-stat">\n                    <span class="profile-stat__value">').concat(t.rating,'</span>\n                    <span class="profile-stat__label">MMR</span>\n                </div>\n                <div class="profile-stat">\n                    <span class="profile-stat__value">').concat(t.stats.wins,'</span>\n                    <span class="profile-stat__label">Victoires</span>\n                </div>\n                <div class="profile-stat">\n                    <span class="profile-stat__value">').concat(t.stats.losses,'</span>\n                    <span class="profile-stat__label">DÃ©faites</span>\n                </div>\n                <div class="profile-stat">\n                    <span class="profile-stat__value">').concat(t.stats.winRate,'%</span>\n                    <span class="profile-stat__label">Win Rate</span>\n                </div>\n            </div>\n        ');t.favoriteCharacter&&(i+='\n                <div class="profile-popup__section">\n                    <h3 class="profile-popup__subtitle">\n                        <i class="fas fa-star"></i> Champion Favori\n                    </h3>\n                    <div class="profile-favorite">\n                        <span class="profile-favorite__name">'.concat(t.favoriteCharacter.name,'</span>\n                        <span class="profile-favorite__role">').concat(t.favoriteCharacter.role,'</span>\n                        <span class="profile-favorite__count">').concat(t.favoriteCharacter.gamesPlayed," parties</span>\n                    </div>\n                </div>\n            ")),t.lastTeam.length>0&&(i+='\n                <div class="profile-popup__section">\n                    <h3 class="profile-popup__subtitle">\n                        <i class="fas fa-users"></i> DerniÃ¨re Ã‰quipe\n                    </h3>\n                    <div class="profile-last-team">\n                        '.concat(t.lastTeam.map(function(t){return'\n                            <div class="profile-last-team__member">\n                                <span class="profile-last-team__name">'.concat(t.name,'</span>\n                                <span class="profile-last-team__role">').concat(t.role,"</span>\n                            </div>\n                        ")}).join(""),"\n                    </div>\n                </div>\n            ")),t.recentBattles.length>0?i+='\n                <div class="profile-popup__section">\n                    <h3 class="profile-popup__subtitle">\n                        <i class="fas fa-shield-alt"></i> Historique\n                    </h3>\n                    <div class="profile-history">\n                        '.concat(t.recentBattles.map(function(t){return'\n                            <a href="/arena/replay/'.concat(t.id,'" class="profile-history__entry ').concat(e(t.result),'">\n                                <span class="profile-history__result">').concat(a(t.result),'</span>\n                                <span class="profile-history__opponent">vs ').concat(t.opponent,'</span>\n                                <span class="profile-history__type">').concat(t.matchType.toUpperCase(),'</span>\n                                <span class="profile-history__date">').concat(t.date,'</span>\n                                <i class="fas fa-play profile-history__replay"></i>\n                            </a>\n                        ')}).join(""),"\n                    </div>\n                </div>\n            "):i+='\n                <div class="profile-popup__section">\n                    <p class="profile-popup__empty">Aucun combat enregistrÃ©</p>\n                </div>\n            ',i+='\n            <div class="profile-popup__actions">\n                <a href="/profile" class="profile-popup__edit-link">\n                    <i class="fas fa-pen"></i> Ã‰diter le profil\n                </a>\n            </div>\n        ',s.innerHTML=i}(t)}).catch(function(){s.innerHTML='<p class="profile-popup__error">Erreur de chargement</p>'})}),n.addEventListener("click",r),a.addEventListener("click",r)}function r(){e.classList.remove("profile-popup--open"),a.classList.remove("profile-popup__backdrop--open"),setTimeout(function(){e.style.display="none",a.style.display="none"},300)}}),console.log("assets/app.js chargÃ© âœ”")}},t=>{t.O(0,[785],()=>{return e=563,t(t.s=e);var e});t.O()}]);