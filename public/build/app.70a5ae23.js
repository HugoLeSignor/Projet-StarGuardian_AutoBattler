(self.webpackChunk=self.webpackChunk||[]).push([[524],{563(e,t,a){"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function s(e,t){var a="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=function(e,t){if(e){if("string"==typeof e)return i(e,t);var a={}.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?i(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){a&&(e=a);var n=0,s=function(){};return{s,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:s}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,c=!0,o=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return c=e.done,e},e:function(e){o=!0,r=e},f:function(){try{c||null==a.return||a.return()}finally{if(o)throw r}}}}function i(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=Array(t);a<t;a++)n[a]=e[a];return n}function r(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,c(n.key),n)}}function c(e){var t=function(e,t){if("object"!=n(e)||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var s=a.call(e,t||"default");if("object"!=n(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==n(t)?t:t+""}var o=function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.container=t,this.logs=[],this.currentIndex=0,this.isPlaying=!1,this.isPaused=!1,this.speed=1,this.characterElements={},this.characterMaxHP={},this.init()},t=[{key:"init",value:function(){var e=this,t=this.container.dataset.combatLogs;if(t)try{this.logs=JSON.parse(t)}catch(e){return void console.error("Erreur parsing logs:",e)}this.logContainer=this.container.querySelector("[data-combat-log]"),this.overlay=this.container.querySelector("[data-combat-overlay]"),this.playBtn=this.container.querySelector("[data-combat-play]"),this.skipBtn=this.container.querySelector("[data-combat-skip]"),this.speedBtns=this.container.querySelectorAll("[data-combat-speed]"),this.characterMaxHP={},this.characterSlugs={},this.characterHasHeal={},this.abilityCooldowns={},this.characterStatuses={},this.container.querySelectorAll("[data-character-name]").forEach(function(t){var a=t.dataset.characterName,n=t.dataset.characterTeam,s="".concat(n,"-").concat(a);e.characterElements[s]=t,e.characterSlugs[s]=t.dataset.characterSlug||"",e.characterHasHeal[s]="true"===t.dataset.hasHeal;var i=t.querySelector(".hp-text");if(i){var r=i.textContent.match(/(\d+)\/(\d+)/);r&&(e.characterMaxHP[s]=parseInt(r[2]))}e.characterStatuses[s]=e.createEmptyStatuses()}),this.abilityElements={},this.container.querySelectorAll(".character-info[data-char-name]").forEach(function(t){var a=t.dataset.charName,n=t.dataset.charTeam,s="".concat(n,"-").concat(a),i=t.querySelector(".character-info__ability");i&&(e.abilityElements[s]={el:i,maxCd:parseInt(i.dataset.abilityMaxCd)||0,badge:i.querySelector(".character-info__ability-cd-badge"),nameEl:i.querySelector(".character-info__ability-name"),iconEl:i.querySelector("i")})}),this.overlay&&(this.overlay.style.display="none",this.overlay.style.opacity="0"),this.logContainer&&(this.logContainer.innerHTML=""),this.audioUnlocked=!1,this.combatMusic=null,this.lastTrackIndex=-1,this.isMuted=!1,this.volume=.05,this.sfxVolume=.15,this.combatPlaylist=["/asset/audio/combat/butchersboulevardmusic.mp3","/asset/audio/combat/combatintheruins.mp3"],this.endMusic=null,this.sfxCache={},this.muteBtn=this.container.querySelector("[data-audio-mute]"),this.volumeSlider=this.container.querySelector("[data-audio-volume]"),this.sfxSlider=this.container.querySelector("[data-sfx-volume]"),this.bindEvents(),setTimeout(function(){return e.play()},800)}},{key:"createEmptyStatuses",value:function(){return{bleeding:0,blighted:0,stunned:!1,marked:0,protected:0,stealthed:0,riposte:0,dmgUp:0,spdUp:0,dodgeUp:0,critUp:0}}},{key:"updateCharacterStatuses",value:function(e){switch(e.type){case"round":return void this.tickRoundStatuses();case"ability_use":this.handleAbilityStatusChange(e);break;case"defend":this.setStatus(e.target,e.targetTeam,"protected",e.duration||2);break;case"bleed_tick":void 0!==e.turnsRemaining&&e.turnsRemaining<=0&&this.setStatus(e.target,e.targetTeam,"bleeding",0);break;case"blight_tick":void 0!==e.turnsRemaining&&e.turnsRemaining<=0&&this.setStatus(e.target,e.targetTeam,"blighted",0);break;case"stunned_skip":this.setStatus(e.target,e.targetTeam,"stunned",!1);break;case"attack":if(e.attacker&&e.attackerTeam){var t="".concat(e.attackerTeam,"-").concat(e.attacker);this.characterStatuses[t]&&this.characterStatuses[t].stealthed>0&&(this.characterStatuses[t].stealthed=0)}break;case"synergy_trigger":this.handleSynergyStatusChange(e);break;case"death":this.clearAllStatuses(e.target,e.targetTeam)}this.renderAllStatusIcons()}},{key:"handleAbilityStatusChange",value:function(e){switch(e.subtype){case"bleed_attack":e.target&&e.targetTeam&&this.setStatus(e.target,e.targetTeam,"bleeding",e.bleedTurns||3);break;case"blight_attack":if(e.allHits){var t=e.allHits.find(function(e){return e.isPrimary});t&&this.setStatus(t.name,t.team,"blighted",e.blightTurns||3)}else e.target&&this.setStatus(e.target,e.targetTeam,"blighted",e.blightTurns||3);break;case"stun":e.target&&e.targetTeam&&this.setStatus(e.target,e.targetTeam,"stunned",!0);break;case"mark":e.target&&e.targetTeam&&this.setStatus(e.target,e.targetTeam,"marked",e.markTurns||3);break;case"riposte_buff":e.caster&&e.casterTeam&&this.setStatus(e.caster,e.casterTeam,"riposte",e.riposteTurns||2);break;case"self_buff":e.caster&&e.casterTeam&&this.applyBuffStatuses(e.caster,e.casterTeam,e.buffs,e.buffDuration||2);break;case"party_buff":e.casterTeam&&this.applyTeamBuffStatuses(e.casterTeam,e.buffs,e.buffDuration||2);break;case"stealth":e.caster&&e.casterTeam&&this.setStatus(e.caster,e.casterTeam,"stealthed",e.stealthTurns||1);break;case"protect_dodge":e.target&&e.targetTeam&&(this.setStatus(e.target,e.targetTeam,"protected",e.protectTurns||2),this.setStatus(e.target,e.targetTeam,"dodgeUp",e.protectTurns||2));break;case"emergency_heal":e.selfBleedTurns&&e.selfBleedTurns>0&&e.caster&&this.setStatus(e.caster,e.casterTeam,"bleeding",e.selfBleedTurns);break;case"bonus_vs_marked":e.target&&e.targetTeam&&"".concat(e.targetTeam,"-").concat(e.target)}}},{key:"handleSynergyStatusChange",value:function(e){var t=this;if(e.effectType)switch(e.effectType){case"grant_riposte":this.setStatus(e.partnerChar,e.partnerCharTeam,"riposte",e.grantedTurns||1);break;case"temp_buff":if(e.buffTypes){var a=e.buffDuration||2;e.buffTypes.forEach(function(n){var s=t.buffTypeToStatusKey(n);s&&t.setStatus(e.partnerChar,e.partnerCharTeam,s,a)})}break;case"apply_mark":e.target&&this.setStatus(e.target,e.targetTeam,"marked",e.markTurns||2);break;case"grant_dodge":this.setStatus(e.partnerChar,e.partnerCharTeam,"dodgeUp",e.dodgeDuration||2);break;case"extend_stealth":if(e.partnerChar&&e.partnerCharTeam){var n="".concat(e.partnerCharTeam,"-").concat(e.partnerChar);this.characterStatuses[n]&&(this.characterStatuses[n].stealthed+=e.extraTurns||1)}break;case"guaranteed_crit":this.setStatus(e.partnerChar,e.partnerCharTeam,"critUp",1)}}},{key:"buffTypeToStatusKey",value:function(e){switch(e){case"damage":return"dmgUp";case"speed":return"spdUp";case"dodge":return"dodgeUp";case"crit":return"critUp";default:return null}}},{key:"applyBuffStatuses",value:function(e,t,a,n){if(a){var s="".concat(t,"-").concat(e),i=this.characterStatuses[s];i&&(a.damage&&a.damage>0&&(i.dmgUp=Math.max(i.dmgUp,n)),a.speed&&a.speed>0&&(i.spdUp=Math.max(i.spdUp,n)),a.dodge&&a.dodge>0&&(i.dodgeUp=Math.max(i.dodgeUp,n)),a.crit&&a.crit>0&&(i.critUp=Math.max(i.critUp,n)))}}},{key:"applyTeamBuffStatuses",value:function(e,t,a){if(t)for(var n=0,s=Object.keys(this.characterStatuses);n<s.length;n++){var i=s[n];if(i.startsWith(e+"-")){var r=this.characterStatuses[i];t.damage&&t.damage>0&&(r.dmgUp=Math.max(r.dmgUp,a)),t.speed&&t.speed>0&&(r.spdUp=Math.max(r.spdUp,a)),t.dodge&&t.dodge>0&&(r.dodgeUp=Math.max(r.dodgeUp,a)),t.crit&&t.crit>0&&(r.critUp=Math.max(r.critUp,a))}}}},{key:"setStatus",value:function(e,t,a,n){var s="".concat(t,"-").concat(e);this.characterStatuses[s]&&(this.characterStatuses[s][a]=n)}},{key:"clearAllStatuses",value:function(e,t){var a="".concat(t,"-").concat(e);this.characterStatuses[a]&&(this.characterStatuses[a]=this.createEmptyStatuses())}},{key:"tickRoundStatuses",value:function(){for(var e=0,t=Object.keys(this.characterStatuses);e<t.length;e++){var a=t[e],n=this.characterStatuses[a];n.marked>0&&n.marked<999&&n.marked--,n.protected>0&&n.protected<999&&n.protected--,n.stealthed>0&&n.stealthed<999&&n.stealthed--,n.riposte>0&&n.riposte<999&&n.riposte--,n.dmgUp>0&&n.dmgUp<999&&n.dmgUp--,n.spdUp>0&&n.spdUp<999&&n.spdUp--,n.dodgeUp>0&&n.dodgeUp<999&&n.dodgeUp--,n.critUp>0&&n.critUp<999&&n.critUp--}this.renderAllStatusIcons()}},{key:"renderAllStatusIcons",value:function(){for(var e=0,t=Object.keys(this.characterStatuses);e<t.length;e++){var a=t[e];this.renderStatusIcons(a)}}},{key:"renderStatusIcons",value:function(e){var t=this.characterElements[e];if(t){var a=t.querySelector(".status-icons");if(a){var n=this.characterStatuses[e],s=[];n.bleeding>0&&s.push({icon:"fa-tint",cls:"status-icon--bleed",title:"Saignement"}),n.blighted>0&&s.push({icon:"fa-skull-crossbones",cls:"status-icon--blight",title:"Peste"}),n.stunned&&s.push({icon:"fa-dizzy",cls:"status-icon--stun",title:"Etourdi"}),n.marked>0&&s.push({icon:"fa-crosshairs",cls:"status-icon--mark",title:"Marque"}),n.protected>0&&s.push({icon:"fa-shield-alt",cls:"status-icon--protect",title:"Protege"}),n.stealthed>0&&s.push({icon:"fa-eye-slash",cls:"status-icon--stealth",title:"Furtif"}),n.riposte>0&&s.push({icon:"fa-exchange-alt",cls:"status-icon--riposte",title:"Riposte"}),n.dmgUp>0&&s.push({icon:"fa-fist-raised",cls:"status-icon--dmg-up",title:"+Degats"}),n.spdUp>0&&s.push({icon:"fa-wind",cls:"status-icon--spd-up",title:"+Vitesse"}),n.dodgeUp>0&&s.push({icon:"fa-running",cls:"status-icon--dodge-up",title:"+Esquive"}),n.critUp>0&&s.push({icon:"fa-bullseye",cls:"status-icon--crit-up",title:"+Critique"}),a.innerHTML=s.map(function(e){return'<span class="status-icon '.concat(e.cls,'" title="').concat(e.title,'"><i class="fas ').concat(e.icon,'"></i></span>')}).join("")}}}},{key:"bindEvents",value:function(){var e=this;this.playBtn&&this.playBtn.addEventListener("click",function(){return e.togglePlay()}),this.skipBtn&&this.skipBtn.addEventListener("click",function(){return e.skip()}),this.speedBtns.forEach(function(t){t.addEventListener("click",function(t){return e.setSpeed(t)})}),this.muteBtn&&this.muteBtn.addEventListener("click",function(){return e.toggleMute()}),this.volumeSlider&&this.volumeSlider.addEventListener("input",function(t){e.volume=parseFloat(t.target.value),e.combatMusic&&(e.combatMusic.volume=e.isMuted?0:e.volume),e.endMusic&&(e.endMusic.volume=e.isMuted?0:e.volume)}),this.sfxSlider&&this.sfxSlider.addEventListener("input",function(t){e.sfxVolume=parseFloat(t.target.value)}),document.addEventListener("click",function(){e.audioUnlocked||(e.audioUnlocked=!0,e.playNextTrack())},{once:!0})}},{key:"play",value:function(){this.isPlaying&&!this.isPaused||(this.isPlaying=!0,this.isPaused=!1,this.updatePlayButton(),this.processNextLog())}},{key:"pause",value:function(){this.isPaused=!0,this.updatePlayButton()}},{key:"togglePlay",value:function(){!this.isPlaying||this.isPaused?this.play():this.pause()}},{key:"skip",value:function(){for(this.isPlaying=!1,this.isPaused=!1;this.currentIndex<this.logs.length;){var e=this.logs[this.currentIndex];this.displayLog(e),this.updateHealthBars(e),this.trackAbilityCooldowns(e),this.updateCharacterStatuses(e),"death"===e.type&&this.animateDeath(e.target,e.targetTeam),"synergy_trigger"===e.type&&0===e.targetHP&&e.target&&this.animateDeath(e.target,e.targetTeam),this.currentIndex++}this.showVictoryOverlay(),this.updatePlayButton()}},{key:"setSpeed",value:function(e){var t=parseFloat(e.currentTarget.dataset.combatSpeed);this.speed=t,this.speedBtns.forEach(function(e){return e.classList.remove("active")}),e.currentTarget.classList.add("active")}},{key:"processNextLog",value:function(){var e=this;if(this.isPlaying&&!this.isPaused){if(this.currentIndex>=this.logs.length)return this.isPlaying=!1,this.showVictoryOverlay(),void this.updatePlayButton();var t=this.logs[this.currentIndex];this.processLog(t),this.currentIndex++;var a=this.getDelayForLog(t);a/=this.speed,setTimeout(function(){return e.processNextLog()},a)}}},{key:"getDelayForLog",value:function(e){switch(e.type){case"round":case"defend":case"protect":return 2500;case"initiative":return 600;case"attack":return 3e3;case"heal":return 2800;case"dodge":case"riposte_activate":case"synergy_announce":return 2e3;case"death":return 3500;case"victory":case"draw":case"bleed_tick":case"blight_tick":return 1500;case"stunned_skip":return 1800;case"ability_use":return this.getAbilityDelay(e);case"synergy_trigger":return this.getSynergyTriggerDelay(e);default:return 1200}}},{key:"getSynergyTriggerDelay",value:function(e){return void 0!==e.damage?3500:2500}},{key:"getAbilityDelay",value:function(e){switch(e.subtype){case"bleed_attack":case"backline_strike":case"armor_pierce":case"bonus_vs_marked":return 3e3;case"blight_attack":return 3500;case"stun":case"party_buff":case"protect_dodge":return 2500;case"mark":case"riposte_buff":case"self_buff":case"stealth":default:return 2e3;case"party_heal":case"emergency_heal":return 2800;case"transform_damage":return 1500}}},{key:"processLog",value:function(e){var t=this;this.playAnimation(e),this.displayLog(e);var a=this.getHPUpdateDelay(e);a>0?setTimeout(function(){return t.updateHealthBars(e)},a/this.speed):this.updateHealthBars(e),this.trackAbilityCooldowns(e),this.updateCharacterStatuses(e)}},{key:"trackAbilityCooldowns",value:function(e){if("ability_use"===e.type&&e.caster&&e.casterTeam){var t="".concat(e.casterTeam,"-").concat(e.caster),a=this.abilityElements[t];a&&a.maxCd>0&&(this.abilityCooldowns[t]=a.maxCd,this.updateAbilityCooldownDisplay(t))}if("round"===e.type)for(var n in this.abilityCooldowns)this.abilityCooldowns[n]>0&&(this.abilityCooldowns[n]--,this.updateAbilityCooldownDisplay(n))}},{key:"updateAbilityCooldownDisplay",value:function(e){var t=this.abilityElements[e];if(t){var a=this.abilityCooldowns[e]||0;a>0?(t.el.classList.add("character-info__ability--on-cd"),t.badge&&(t.badge.textContent="".concat(a,"T"),t.badge.style.display="inline")):(t.el.classList.remove("character-info__ability--on-cd"),t.badge&&(t.badge.style.display="none"))}}},{key:"getHPUpdateDelay",value:function(e){switch(e.type){case"attack":case"riposte_activate":return 350;case"heal":return 400;case"death":default:return 0;case"bleed_tick":case"blight_tick":return 200;case"ability_use":return this.getAbilityHPDelay(e);case"synergy_trigger":return 800}}},{key:"getAbilityHPDelay",value:function(e){switch(e.subtype){case"bleed_attack":case"blight_attack":case"backline_strike":case"armor_pierce":case"bonus_vs_marked":case"stun":return 350;case"party_heal":case"emergency_heal":return 400;case"transform_damage":return 200;default:return 0}}},{key:"playAnimation",value:function(e){switch(e.type){case"attack":this.animateAttack(e.attacker,e.attackerTeam,e.target,e.targetTeam,e.isCrit);break;case"heal":this.animateHeal(e.healer,e.healerTeam,e.target,e.targetTeam);break;case"defend":this.animateDefend(e.defender,e.defenderTeam);break;case"dodge":this.animateDodge(e.target,e.targetTeam);break;case"death":this.animateDeath(e.target,e.targetTeam);break;case"bleed_tick":this.animateDoT(e.target,e.targetTeam,"bleeding");break;case"blight_tick":this.animateDoT(e.target,e.targetTeam,"blighted");break;case"stunned_skip":this.animateStunned(e.target,e.targetTeam);break;case"riposte_activate":this.animateAttack(e.attacker,e.attackerTeam,e.target,e.targetTeam,!1);break;case"ability_use":this.playAbilityAnimation(e);break;case"synergy_announce":this.animateSynergyAnnounce(e);break;case"synergy_trigger":this.animateSynergyTrigger(e)}}},{key:"animateDoT",value:function(e,t,a){var n=this.getCharacterElement(e,t);n&&(n.classList.add(a),setTimeout(function(){return n.classList.remove(a)},1e3))}},{key:"animateStunned",value:function(e,t){var a=this.getCharacterElement(e,t);a&&(a.classList.add("stunned"),setTimeout(function(){return a.classList.remove("stunned")},1400))}},{key:"animateMarked",value:function(e,t){var a=this.getCharacterElement(e,t);a&&(a.classList.add("marked"),setTimeout(function(){return a.classList.remove("marked")},2e3))}},{key:"animateBuff",value:function(e,t){var a=this.getCharacterElement(e,t);a&&(a.classList.add("buffed"),setTimeout(function(){return a.classList.remove("buffed")},1400))}},{key:"animateStealth",value:function(e,t){var a=this.getCharacterElement(e,t);a&&(a.classList.add("stealthed"),setTimeout(function(){return a.classList.remove("stealthed")},1500))}},{key:"playAbilityAnimation",value:function(e){var t=this;switch(e.subtype){case"bleed_attack":e.caster&&e.casterTeam&&this.animateAttack(e.caster,e.casterTeam,e.target,e.targetTeam,!1),e.target&&e.targetTeam&&setTimeout(function(){return t.animateDoT(e.target,e.targetTeam,"bleeding")},700);break;case"blight_attack":if(e.caster&&e.casterTeam){var a="".concat(e.casterTeam,"-").concat(e.caster);this.swapSprite(a,"skill.webp",1400),this.playCharSfx(a,"skill");var n=this.getCharacterElement(e.caster,e.casterTeam);n&&(n.classList.add("attacking"),setTimeout(function(){return n.classList.remove("attacking")},1200))}if(e.allHits){setTimeout(function(){e.allHits.forEach(function(e){var a=t.getCharacterElement(e.name,e.team);a&&(a.classList.add("hurt"),setTimeout(function(){return a.classList.remove("hurt")},800))})},500);var s=e.allHits.find(function(e){return e.isPrimary});s&&setTimeout(function(){return t.animateDoT(s.name,s.team,"blighted")},1e3)}else e.target&&e.targetTeam&&setTimeout(function(){return t.animateDoT(e.target,e.targetTeam,"blighted")},700);break;case"stun":e.caster&&e.casterTeam&&this.animateAttack(e.caster,e.casterTeam,e.target,e.targetTeam,!1),e.target&&e.targetTeam&&setTimeout(function(){return t.animateStunned(e.target,e.targetTeam)},700);break;case"mark":if(e.caster&&e.casterTeam){var i="".concat(e.casterTeam,"-").concat(e.caster);this.swapSprite(i,"skill.webp",1400),this.playCharSfx(i,"skill"),this.animateBuff(e.caster,e.casterTeam)}e.target&&e.targetTeam&&this.animateMarked(e.target,e.targetTeam);break;case"riposte_buff":if(e.caster&&e.casterTeam){var r="".concat(e.casterTeam,"-").concat(e.caster);this.swapSprite(r,"skill.webp",1400),this.playCharSfx(r,"skill"),this.animateBuff(e.caster,e.casterTeam)}break;case"self_buff":if(e.caster&&e.casterTeam){var c="".concat(e.casterTeam,"-").concat(e.caster);"Transformation"===e.abilityName&&(this.characterSlugs[c]="beast"),this.swapSprite(c,"skill.webp",1400),this.playCharSfx(c,"skill"),this.animateBuff(e.caster,e.casterTeam)}break;case"party_heal":if(e.caster&&e.casterTeam){var o="".concat(e.casterTeam,"-").concat(e.caster);this.playCharSfx(o,"heal"),this.animateHeal(e.caster,e.casterTeam,e.caster,e.casterTeam),e.healed&&e.healed.forEach(function(e){var a=t.getCharacterElement(e.name,e.team);a&&(a.classList.add("healed"),setTimeout(function(){return a.classList.remove("healed")},1500))})}break;case"party_buff":if(e.caster&&e.casterTeam){var l="".concat(e.casterTeam,"-").concat(e.caster);this.swapSprite(l,"skill.webp",1400),this.playCharSfx(l,"skill"),this.animateBuff(e.caster,e.casterTeam)}this.animateTeamBuff(e.casterTeam);break;case"stealth":if(e.caster&&e.casterTeam){var d="".concat(e.casterTeam,"-").concat(e.caster);this.swapSprite(d,"skill.webp",1400),this.playCharSfx(d,"skill"),this.animateStealth(e.caster,e.casterTeam)}break;case"armor_pierce":case"backline_strike":case"bonus_vs_marked":e.caster&&e.casterTeam&&this.animateAttack(e.caster,e.casterTeam,e.target,e.targetTeam,e.isCrit||!1);break;case"emergency_heal":if(e.caster&&e.casterTeam){var u="".concat(e.casterTeam,"-").concat(e.caster);this.playCharSfx(u,"heal"),this.animateHeal(e.caster,e.casterTeam,e.caster,e.casterTeam)}break;case"protect_dodge":if(e.caster&&e.casterTeam){var p="".concat(e.casterTeam,"-").concat(e.caster);this.playCharSfx(p,"skill"),this.animateDefend(e.caster,e.casterTeam)}break;case"transform_damage":if(e.target&&e.targetTeam){var h=this.getCharacterElement(e.target,e.targetTeam);h&&(h.classList.add("hurt"),setTimeout(function(){return h.classList.remove("hurt")},800))}}}},{key:"animateTeamBuff",value:function(e){var t=this;Object.keys(this.characterElements).forEach(function(a){if(a.startsWith(e)){var n=t.characterElements[a];n.classList.add("buffed"),setTimeout(function(){return n.classList.remove("buffed")},1400)}})}},{key:"animateSynergyAnnounce",value:function(e){var t=this.getCharacterElement(e.triggerChar,e.team),a=this.getCharacterElement(e.partnerChar,e.team);t&&(t.classList.add("synergy-announce-glow"),setTimeout(function(){return t.classList.remove("synergy-announce-glow")},1500)),a&&setTimeout(function(){a.classList.add("synergy-announce-glow"),setTimeout(function(){return a.classList.remove("synergy-announce-glow")},1500)},300),t&&a&&this.drawSynergyLink(t,a)}},{key:"animateSynergyTrigger",value:function(e){var t=this,a=this.getCharacterElement(e.triggerChar,e.triggerCharTeam),n=this.getCharacterElement(e.partnerChar,e.partnerCharTeam);a&&(a.classList.add("synergy-trigger-glow"),setTimeout(function(){return a.classList.remove("synergy-trigger-glow")},1800)),a&&n&&setTimeout(function(){return t.drawSynergyLink(a,n)},400),n&&setTimeout(function(){if(n.classList.add("synergy-react"),setTimeout(function(){return n.classList.remove("synergy-react")},800),void 0!==e.damage&&e.target){var a="".concat(e.partnerCharTeam,"-").concat(e.partnerChar);t.swapSprite(a,"attackanimation.webp",1200),t.playCharSfx(a,"attack");var s=t.getCharacterElement(e.target,e.targetTeam);s&&setTimeout(function(){s.classList.add("hurt"),setTimeout(function(){return s.classList.remove("hurt")},800)},400)}},800)}},{key:"drawSynergyLink",value:function(e,t){var a=this.container.querySelector(".battle-stage");if(a){var n=a.querySelector(".synergy-link-svg");n&&n.remove();var s=document.createElementNS("http://www.w3.org/2000/svg","svg");s.classList.add("synergy-link-svg"),s.setAttribute("width","100%"),s.setAttribute("height","100%");var i=a.getBoundingClientRect(),r=e.getBoundingClientRect(),c=t.getBoundingClientRect(),o=r.left+r.width/2-i.left,l=r.top+r.height/2-i.top,d=c.left+c.width/2-i.left,u=c.top+c.height/2-i.top,p=document.createElementNS("http://www.w3.org/2000/svg","line");p.classList.add("synergy-link-line"),p.setAttribute("x1",o),p.setAttribute("y1",l),p.setAttribute("x2",d),p.setAttribute("y2",u),s.appendChild(p),a.appendChild(s),setTimeout(function(){return s.remove()},1800/this.speed)}}},{key:"swapSprite",value:function(e,t,a){var n=this,s=this.characterElements[e];if(s){var i=this.characterSlugs[e];if(i){var r=s.querySelector(".character-sprite");r&&(r.src="/asset/img/combat/".concat(i,"/").concat(t),a>0&&setTimeout(function(){s.classList.contains("dead")||(r.src="/asset/img/combat/".concat(n.characterSlugs[e],"/fightidle.webp"))},a))}}}},{key:"animateAttack",value:function(e,t,a,n,s){var i=this.getCharacterElement(e,t),r=this.getCharacterElement(a,n);if(i){var c="".concat(t,"-").concat(e);this.swapSprite(c,"attackanimation.webp",1200),i.classList.add("attacking"),this.playCharSfx(c,"attack"),setTimeout(function(){return i.classList.remove("attacking")},1200)}r&&setTimeout(function(){r.classList.add("hurt"),s&&r.classList.add("crit"),setTimeout(function(){return r.classList.remove("hurt","crit")},800)},500)}},{key:"animateHeal",value:function(e,t,a,n){var s=this.getCharacterElement(e,t),i=this.getCharacterElement(a,n);if(s){var r="".concat(t,"-").concat(e);this.characterHasHeal[r]?this.swapSprite(r,"healing.webp",1500):this.swapSprite(r,"skill.webp",1500),s.classList.add("healing"),this.playCharSfx(r,"heal"),setTimeout(function(){return s.classList.remove("healing")},1500)}i&&(i.classList.add("healed"),setTimeout(function(){return i.classList.remove("healed")},1500))}},{key:"animateDefend",value:function(e,t){var a=this.getCharacterElement(e,t);if(a){var n="".concat(t,"-").concat(e);this.swapSprite(n,"defending.webp",1800),a.classList.add("defending"),this.playCharSfx(n,"skill"),setTimeout(function(){return a.classList.remove("defending")},1800)}}},{key:"animateDodge",value:function(e,t){var a=this.getCharacterElement(e,t);a&&(a.classList.add("dodging"),setTimeout(function(){return a.classList.remove("dodging")},1e3))}},{key:"animateDeath",value:function(e,t){var a=this.getCharacterElement(e,t);if(a){var n="".concat(t,"-").concat(e),s=this.characterSlugs[n],i=a.querySelector(".character-sprite");if(i&&s){var r=new Image;r.src="/asset/img/combat/".concat(s,"/corpse.png"),r.onload=function(){i.src=r.src,a.classList.add("dead","dead--corpse")},r.onerror=function(){a.classList.add("dead")}}else a.classList.add("dead")}}},{key:"getCharacterElement",value:function(e,t){return this.characterElements["".concat(t,"-").concat(e)]}},{key:"displayLog",value:function(e){if(this.logContainer){var t=document.createElement("p");t.className="combat-log__entry","round"===e.type?t.classList.add("combat-log__entry--round"):"victory"===e.type?t.classList.add("combat-log__entry--victory"):"draw"===e.type?t.classList.add("combat-log__entry--defeat"):"ability_use"===e.type?t.classList.add("combat-log__entry--ability"):"bleed_tick"===e.type?t.classList.add("combat-log__entry--bleed"):"blight_tick"===e.type?t.classList.add("combat-log__entry--blight"):"stunned_skip"===e.type?t.classList.add("combat-log__entry--stun"):"riposte_activate"===e.type?t.classList.add("combat-log__entry--riposte"):"synergy_announce"===e.type?t.classList.add("combat-log__entry--synergy-announce"):"synergy_trigger"===e.type&&t.classList.add("combat-log__entry--synergy-trigger"),t.innerHTML=e.message,this.logContainer.appendChild(t),this.logContainer.scrollTop=this.logContainer.scrollHeight}}},{key:"updateHealthBars",value:function(e){var t=null,a=null,n=null,s=null;if("attack"===e.type||"riposte_activate"===e.type)t=e.target,a=e.targetTeam,n=e.targetHP,s=e.targetMaxHP;else if("heal"===e.type)t=e.target,a=e.targetTeam,n=e.targetHP,s=e.targetMaxHP;else if("bleed_tick"===e.type||"blight_tick"===e.type)t=e.target,a=e.targetTeam,n=e.targetHP,s=e.targetMaxHP;else{if("ability_use"===e.type)return void this.updateAbilityHealthBars(e);"synergy_trigger"===e.type&&e.target&&void 0!==e.targetHP&&e.targetMaxHP&&(t=e.target,a=e.targetTeam,n=e.targetHP,s=e.targetMaxHP)}t&&a&&null!=n&&s&&this.updateCharacterHP(t,a,n,s)}},{key:"updateAbilityHealthBars",value:function(e){var t=this;e.allHits?e.allHits.forEach(function(e){t.updateCharacterHP(e.name,e.team,e.hp,e.maxHp)}):e.target&&void 0!==e.targetHP&&e.targetMaxHP&&this.updateCharacterHP(e.target,e.targetTeam,e.targetHP,e.targetMaxHP),"party_heal"===e.subtype&&e.healed&&e.healed.forEach(function(e){t.updateCharacterHP(e.name,e.team,e.hp,e.maxHp)}),"emergency_heal"===e.subtype&&e.caster&&this.updateCharacterHP(e.caster,e.casterTeam,e.targetHP,e.targetMaxHP)}},{key:"updateCharacterHP",value:function(e,t,a,n){var s=this.getCharacterElement(e,t);if(s){var i=n>0?a/n*100:0,r=s.querySelector(".hp-bar__fill"),c=s.querySelector(".hp-text");r&&(r.style.transition="width 0.3s ease-out",r.style.width="".concat(i,"%"),r.classList.remove("hp-bar__fill--low","hp-bar__fill--critical"),i<=25?r.classList.add("hp-bar__fill--critical"):i<=50&&r.classList.add("hp-bar__fill--low")),c&&(c.textContent="".concat(a,"/").concat(n)),this.updateInfoPanel(e,t,a)}}},{key:"updateInfoPanel",value:function(e,t,a){var n="Equipe 1"===t?".info-panel--team1":".info-panel--team2",i=this.container.querySelector(n);if(i){var r,c=s(i.querySelectorAll(".character-info"));try{var o=function(){var t=r.value,n=t.querySelector(".character-info__name");if(n&&n.textContent.trim()===e){var s=t.querySelector(".character-info__stats span");return s&&(s.textContent=a,s.classList.add("hp-updated"),setTimeout(function(){return s.classList.remove("hp-updated")},300)),1}};for(c.s();!(r=c.n()).done&&!o(););}catch(e){c.e(e)}finally{c.f()}}}},{key:"showVictoryOverlay",value:function(){var e=this;this.overlay&&(this.overlay.style.display="flex",setTimeout(function(){e.overlay.style.opacity="1"},50)),this.playEndMusic(),this.finalizeRating()}},{key:"playEndMusic",value:function(){this.combatMusic&&(this.combatMusic.pause(),this.combatMusic=null);var e=null;this.overlay&&(this.overlay.classList.contains("battle-stage__overlay--victory")?e="/asset/ost/winlose/victory.mp3":(this.overlay.classList.contains("battle-stage__overlay--defeat")||this.overlay.classList.contains("battle-stage__overlay--draw"))&&(e="/asset/ost/winlose/defeat.mp3")),e&&!this.isMuted&&(this.endMusic=new Audio(e),this.endMusic.volume=this.volume,this.endMusic.play().catch(function(){}))}},{key:"finalizeRating",value:function(){var e=this,t=this.container.dataset.finalizeUrl;t&&fetch(t,{method:"POST",headers:{"X-Requested-With":"XMLHttpRequest"}}).then(function(e){return e.json()}).then(function(t){t.success&&0!==t.ratingChange&&e.showRatingUpdate(t.ratingChange,t.newRating,t.newRating2)}).catch(function(e){return console.error("Erreur finalisation rating:",e)})}},{key:"showRatingUpdate",value:function(e,t,a){var n=this.container.querySelector(".info-panel--team1 .info-panel__rating");n&&null!==t&&(n.innerHTML='<i class="fas fa-trophy"></i> '.concat(t," MMR"));var s=this.container.querySelector(".info-panel--team2 .info-panel__rating--enemy");s&&null!==a&&(s.innerHTML='<i class="fas fa-trophy"></i> '.concat(a," MMR"));var i=this.container.querySelector("[data-combat-overlay]");if(i){var r=i.querySelector(".battle-stage__winner"),c=document.createElement("div");c.className="rating-change",c.style.cssText="font-size:1.2rem;margin-top:12px;font-weight:bold;opacity:0;transition:opacity 0.5s;",c.textContent=e>0?"Equipe 1 : +".concat(e," MMR"):"Equipe 1 : ".concat(e," MMR"),c.style.color=e>0?"#4caf50":"#f44336",r.appendChild(c);var o=-e,l=document.createElement("div");l.className="rating-change",l.style.cssText="font-size:1.2rem;margin-top:6px;font-weight:bold;opacity:0;transition:opacity 0.5s;",l.textContent=o>0?"Equipe 2 : +".concat(o," MMR"):"Equipe 2 : ".concat(o," MMR"),l.style.color=o>0?"#4caf50":"#f44336",r.appendChild(l),setTimeout(function(){c.style.opacity="1",l.style.opacity="1"},100)}}},{key:"playNextTrack",value:function(){var e=this;if(this.audioUnlocked){this.combatMusic&&(this.combatMusic.pause(),this.combatMusic=null);var t=this.getRandomTrackIndex();this.combatMusic=new Audio(this.combatPlaylist[t]),this.combatMusic.volume=this.isMuted?0:this.volume,this.combatMusic.addEventListener("ended",function(){return e.playNextTrack()}),this.combatMusic.play().catch(function(){})}}},{key:"getRandomTrackIndex",value:function(){var e;do{e=Math.floor(Math.random()*this.combatPlaylist.length)}while(e===this.lastTrackIndex&&this.combatPlaylist.length>1);return this.lastTrackIndex=e,e}},{key:"toggleMute",value:function(){if(this.isMuted=!this.isMuted,this.combatMusic&&(this.combatMusic.volume=this.isMuted?0:this.volume),this.endMusic&&(this.endMusic.volume=this.isMuted?0:this.volume),this.muteBtn){var e=this.muteBtn.querySelector("i");e&&(e.className=this.isMuted?"fas fa-volume-mute":"fas fa-volume-up")}this.volumeSlider&&(this.volumeSlider.disabled=this.isMuted),this.sfxSlider&&(this.sfxSlider.disabled=this.isMuted)}},{key:"loadSfx",value:function(e){return this.sfxCache[e]||(this.sfxCache[e]=new Audio(e)),this.sfxCache[e]}},{key:"playSfx",value:function(e,t){if(!this.isMuted&&e){var a="/asset/ost/vfx/".concat(e,"/").concat(t,".wav"),n=this.loadSfx(a).cloneNode();n.volume=this.sfxVolume,n.play().catch(function(){})}}},{key:"playCharSfx",value:function(e,t){var a=this.characterSlugs[e];if(a)switch(t){case"attack":this.playSfx(a,"attacksound");break;case"heal":this.characterHasHeal[e]?this.playSfx(a,"heal"):this.playSfx(a,"skillsound");break;case"skill":this.playSfx(a,"skillsound")}}},{key:"updatePlayButton",value:function(){this.playBtn&&(this.isPlaying&&!this.isPaused?this.playBtn.textContent="Pause":this.currentIndex>=this.logs.length?(this.playBtn.textContent="Terminé",this.playBtn.disabled=!0):this.playBtn.textContent=this.currentIndex>0?"Reprendre":"Lancer")}}],t&&r(e.prototype,t),a&&r(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,a}();document.addEventListener("DOMContentLoaded",function(){var e=document.querySelector("[data-combat-logs]");e&&new o(e)});a(6);function l(e){if(!e)return"";var t=document.createElement("div");return t.appendChild(document.createTextNode(e)),t.innerHTML}document.addEventListener("DOMContentLoaded",function(){var e=document.querySelector(".burger"),t=document.querySelector(".main-navigation");e&&t&&e.addEventListener("click",function(){t.classList.toggle("active")})});var d=30,u=12,p=40,h=15,f=75;document.addEventListener("DOMContentLoaded",function(){var e=document.querySelectorAll(".team-portrait"),t=document.getElementById("teamDetails"),a=document.querySelector(".selected-list"),n=document.querySelector(".btn-launch");if(t&&0!==e.length){var s=[],i=[];e.forEach(function(a){a.addEventListener("click",function(){e.forEach(function(e){return e.classList.remove("active")}),a.classList.add("active");var n=a.dataset.id,r=a.dataset.name,o=a.dataset.role,m=Number(a.dataset.dmgMin),y=Number(a.dataset.dmgMax),g=Number(a.dataset.speed),v=Number(a.dataset.dodge),b=Number(a.dataset.crit),k=Number(a.dataset.hp),L=a.dataset.sprite,C=a.dataset.abilityName||"",E=a.dataset.abilityDesc||"",M=a.dataset.abilityCd||"",q="/asset/sprites/".concat(L),w=i.includes(n),x=C?'\n                    <div class="ability-section">\n                        <div class="ability-section__header">\n                            <i class="fas fa-fire-alt"></i>\n                            <span class="ability-section__name">'.concat(l(C),'</span>\n                            <span class="ability-section__cd"><i class="fas fa-hourglass-half"></i> ').concat(l(M),'T</span>\n                        </div>\n                        <p class="ability-section__desc">').concat(l(E),"</p>\n                    </div>\n            "):"",H=c[r]||[],P="";H.length>0&&(P='\n                    <div class="synergy-section">\n                        <div class="synergy-section__header">\n                            <i class="fas fa-link"></i>\n                            <span class="synergy-section__title">Synergies</span>\n                        </div>\n                        '.concat(H.map(function(e){return'\n                            <div class="synergy-section__item '.concat(s.includes(e.partner)?"synergy-section__item--active":"",'">\n                                <span class="synergy-section__partner">').concat(l(e.partner),'</span>\n                                <span class="synergy-section__sname">').concat(l(e.name),'</span>\n                                <p class="synergy-section__desc">').concat(l(e.desc),"</p>\n                            </div>\n                        ")}).join(""),"\n                    </div>\n                ")),t.innerHTML='\n                <div class="team-details-content">\n                    <h2>'.concat(r,'</h2>\n                    <p class="role">').concat(o,'</p>\n\n                    <div class="gif-container">\n                        <img src="').concat(q,'" alt="Sprite de ').concat(r,'">\n                    </div>\n\n                    <div class="stats">\n                        <div class="stat">\n                            <span>DMG</span>\n                            <div class="stat-bar">\n                                <div class="stat-fill stat-fill--dmg"\n                                    style="width:').concat(Math.min(y/d*100,100),'%">\n                                </div>\n                            </div>\n                            <span>').concat(m," - ").concat(y,'</span>\n                        </div>\n\n                        <div class="stat">\n                            <span>VIT</span>\n                            <div class="stat-bar">\n                                <div class="stat-fill stat-fill--spd"\n                                    style="width:').concat(Math.min(g/u*100,100),'%">\n                                </div>\n                            </div>\n                            <span>').concat(g,'</span>\n                        </div>\n\n                        <div class="stat">\n                            <span>DODGE</span>\n                            <div class="stat-bar">\n                                <div class="stat-fill stat-fill--dodge"\n                                    style="width:').concat(Math.min(v/p*100,100),'%">\n                                </div>\n                            </div>\n                            <span>').concat(v,'</span>\n                        </div>\n\n                        <div class="stat">\n                            <span>CRIT</span>\n                            <div class="stat-bar">\n                                <div class="stat-fill stat-fill--crit"\n                                    style="width:').concat(Math.min(b/h*100,100),'%">\n                                </div>\n                            </div>\n                            <span>').concat(b,'</span>\n                        </div>\n\n                        <div class="stat">\n                            <span>HP</span>\n                            <div class="stat-bar">\n                                <div class="stat-fill stat-fill--hp"\n                                    style="width:').concat(Math.min(k/f*100,100),'%">\n                                </div>\n                            </div>\n                            <span>').concat(k,"</span>\n                        </div>\n                    </div>\n\n                    ").concat(x,"\n                    ").concat(P,'\n\n                    <button class="btn-select-right">\n                        ').concat(w?"Désélectionner":"Sélectionner","\n                    </button>\n                </div>\n            ");var A=t.querySelector(".btn-select-right"),I=_(a);i.includes(n)||S(a)||(A.disabled=!0,A.textContent="Slot ".concat(I," déjà pris")),A.addEventListener("click",function(){if(i.includes(n))i=i.filter(function(e){return e!==n}),s=s.filter(function(e){return e!==r}),a.classList.remove("selected");else{if(!S(a))return void alert("Vous avez déjà un ".concat(I," dans votre équipe !"));if(i.length>=4)return void alert("Vous pouvez sélectionner maximum 4 personnages !");i.push(n),s.push(r),a.classList.add("selected")}T(),A.textContent=i.includes(n)?"Désélectionner":"Sélectionner",A.disabled=!1})})});var r=document.querySelector(".teams-page"),c=r?JSON.parse(r.dataset.synergyMap||"{}"):{},o=document.querySelector(".btn-save-preset"),m=document.getElementById("presetModal"),y=document.getElementById("presetName"),g=document.getElementById("presetConfirm"),v=document.getElementById("presetCancel");o&&m&&(o.addEventListener("click",function(){y.value="",m.style.display="flex",setTimeout(function(){return y.focus()},100)}),v.addEventListener("click",function(){m.style.display="none"}),m.querySelector(".preset-modal__backdrop").addEventListener("click",function(){m.style.display="none"}),g.addEventListener("click",function(){var e=y.value.trim();e?(g.disabled=!0,g.textContent="...",fetch("/teams/presets/save",{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({name:e,characterIds:i.map(Number)})}).then(function(e){return e.json()}).then(function(e){e.success?window.location.reload():(alert(e.error||"Erreur lors de la sauvegarde"),g.disabled=!1,g.textContent="Sauvegarder")}).catch(function(){alert("Erreur lors de la sauvegarde"),g.disabled=!1,g.textContent="Sauvegarder"})):y.style.borderColor="#dc143c"}),y.addEventListener("keydown",function(e){"Enter"===e.key&&g.click(),y.style.borderColor=""})),document.querySelectorAll(".preset-chip").forEach(function(t){var a=t.dataset.presetId,n=JSON.parse(t.dataset.presetIds);t.querySelector(".preset-chip__load").addEventListener("click",function(){var t;t=n,i=[],s=[],e.forEach(function(e){return e.classList.remove("selected")}),t.forEach(function(t){var a=String(t),n=Array.from(e).find(function(e){return e.dataset.id===a});n&&(i.push(a),s.push(n.dataset.name),n.classList.add("selected"))}),T(),C()}),t.querySelector(".preset-chip__delete").addEventListener("click",function(e){e.stopPropagation(),function(e,t){confirm("Supprimer ce preset ?")&&fetch("/teams/presets/".concat(e),{method:"DELETE",headers:{"X-Requested-With":"XMLHttpRequest"}}).then(function(e){return e.json()}).then(function(e){if(e.success){t.remove();var a,n=document.querySelector(".presets-bar__list");n&&0===n.children.length&&(null===(a=document.querySelector(".presets-bar"))||void 0===a||a.remove())}}).catch(function(){return alert("Erreur lors de la suppression")})}(a,t)})});var b=new MutationObserver(function(){return C()});a&&b.observe(a,{childList:!0}),n&&n.addEventListener("click",function(){i.length>0&&fetch("/teams/select",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded","X-Requested-With":"XMLHttpRequest"},body:i.map(function(e,t){return"character_ids[".concat(t,"]=").concat(encodeURIComponent(e))}).join("&")}).then(function(e){e.redirected?window.location.href=e.url:window.location.href="/matchmaking"}).catch(function(){alert("Erreur lors de la sélection de l'équipe.")})})}function _(e){return e.dataset.category||"Support"}function k(){var t={Tank:0,DPS:0,Healer:0,Support:0};return i.forEach(function(a){var n=Array.from(e).find(function(e){return e.dataset.id===a});if(n){var s=_(n);t[s]++}}),t}function S(e){var t=_(e);return k()[t]<1}function T(){if(a.innerHTML="",i.forEach(function(t){var n=Array.from(e).find(function(e){return e.dataset.id===t});if(n){var s=n.dataset.name,i="/asset/sprites/".concat(n.dataset.sprite),r=document.createElement("div");r.classList.add("selected-hero-sprite"),r.innerHTML='\n                <img src="'.concat(i,'" alt="Sprite de ').concat(s,'">\n                <span>').concat(s,"</span>\n            "),a.appendChild(r)}}),L(),function(){if(e.forEach(function(e){e.classList.remove("synergy-available","synergy-active");var t=e.querySelector(".synergy-badge");t&&t.remove()}),0===i.length)return;var t=i.map(function(t){var a=Array.from(e).find(function(e){return e.dataset.id===t});return a?a.dataset.name:null}).filter(Boolean),a=[],n=new Set;t.forEach(function(e){(c[e]||[]).forEach(function(s){if(t.includes(s.partner)){var i=[e,s.partner].sort().join("+");n.has(i)||(n.add(i),a.push({name1:e,name2:s.partner,synergyName:s.name,desc:s.desc}))}})}),a.forEach(function(t){e.forEach(function(e){e.dataset.name!==t.name1&&e.dataset.name!==t.name2||!i.includes(e.dataset.id)||e.classList.add("synergy-active")})}),e.forEach(function(e){if(!i.includes(e.dataset.id)){var a=e.dataset.name,n=(c[a]||[]).filter(function(e){return t.includes(e.partner)});if(n.length>0){e.classList.add("synergy-available");var s=document.createElement("div");s.className="synergy-badge",s.innerHTML='<i class="fas fa-link"></i>',s.title=n.map(function(e){return e.name}).join(", "),e.appendChild(s)}}}),function(e){var t=document.querySelector(".synergy-display");if(!t){(t=document.createElement("div")).className="synergy-display";var a=document.querySelector(".selected-team__actions");a&&a.parentNode.insertBefore(t,a)}if(0===e.length)return void(t.innerHTML="");t.innerHTML='\n            <div class="synergy-display__title">\n                <i class="fas fa-link"></i> Synergies actives\n            </div>\n            '.concat(e.map(function(e){return'\n                <div class="synergy-display__item">\n                    <span class="synergy-display__name">'.concat(l(e.synergyName),'</span>\n                    <span class="synergy-display__chars">').concat(l(e.name1)," + ").concat(l(e.name2),'</span>\n                    <span class="synergy-display__desc">').concat(l(e.desc),"</span>\n                </div>\n            ")}).join(""),"\n        ")}(a)}(),n){var t=k(),s=1===t.Tank&&1===t.DPS&&1===t.Healer&&1===t.Support;n.disabled=!s}}function L(){var e=k(),t=document.querySelector(".role-indicator");t&&t.querySelectorAll(".role-slot").forEach(function(t){var a=t.dataset.role;1===e[a]?t.classList.add("filled"):t.classList.remove("filled")})}function C(){if(o){var e=k(),t=1===e.Tank&&1===e.DPS&&1===e.Healer&&1===e.Support;o.disabled=!t}}}),document.addEventListener("DOMContentLoaded",function(){var e=document.querySelector("[data-profile-toggle]"),t=document.querySelector("[data-profile-popup]"),a=document.querySelector("[data-profile-backdrop]"),n=document.querySelector("[data-profile-close]"),s=document.querySelector("[data-profile-content]");if(e&&t){var i=!1;e.addEventListener("click",function(){t.style.display="block",a.style.display="block",t.offsetHeight,t.classList.add("profile-popup--open"),a.classList.add("profile-popup__backdrop--open"),i||fetch("/api/profile").then(function(e){return e.json()}).then(function(e){i=!0,function(e){var t=function(e){return"win"===e?"result--win":"loss"===e?"result--loss":"result--draw"},a=function(e){return"win"===e?"Victoire":"loss"===e?"Défaite":"Nul"},n=e.profileImage?'<img src="'.concat(l(e.profileImage),'" alt="Avatar de ').concat(l(e.username),'">'):'<i class="fas fa-user-circle" aria-hidden="true"></i>',i='\n            <div class="profile-popup__identity">\n                <div class="profile-popup__avatar">'.concat(n,'</div>\n                <div class="profile-popup__info">\n                    <span class="profile-popup__username">').concat(l(e.username),"</span>\n                    ").concat(e.motto?'<span class="profile-popup__motto">« '.concat(l(e.motto)," »</span>"):"","\n                    ").concat(e.bio?'<p class="profile-popup__bio">'.concat(l(e.bio),"</p>"):"",'\n                </div>\n            </div>\n\n            <div class="profile-popup__stats">\n                <div class="profile-stat">\n                    <span class="profile-stat__value">').concat(l(String(e.rating)),'</span>\n                    <span class="profile-stat__label">MMR</span>\n                </div>\n                <div class="profile-stat">\n                    <span class="profile-stat__value">').concat(l(String(e.stats.wins)),'</span>\n                    <span class="profile-stat__label">Victoires</span>\n                </div>\n                <div class="profile-stat">\n                    <span class="profile-stat__value">').concat(l(String(e.stats.losses)),'</span>\n                    <span class="profile-stat__label">Défaites</span>\n                </div>\n                <div class="profile-stat">\n                    <span class="profile-stat__value">').concat(l(String(e.stats.winRate)),'%</span>\n                    <span class="profile-stat__label">Win Rate</span>\n                </div>\n            </div>\n        ');e.favoriteCharacter&&(i+='\n                <div class="profile-popup__section">\n                    <h3 class="profile-popup__subtitle">\n                        <i class="fas fa-star" aria-hidden="true"></i> Champion Favori\n                    </h3>\n                    <div class="profile-favorite">\n                        <span class="profile-favorite__name">'.concat(l(e.favoriteCharacter.name),'</span>\n                        <span class="profile-favorite__role">').concat(l(e.favoriteCharacter.role),'</span>\n                        <span class="profile-favorite__count">').concat(l(String(e.favoriteCharacter.gamesPlayed))," parties</span>\n                    </div>\n                </div>\n            ")),e.lastTeam.length>0&&(i+='\n                <div class="profile-popup__section">\n                    <h3 class="profile-popup__subtitle">\n                        <i class="fas fa-users" aria-hidden="true"></i> Dernière Équipe\n                    </h3>\n                    <div class="profile-last-team">\n                        '.concat(e.lastTeam.map(function(e){return'\n                            <div class="profile-last-team__member">\n                                <span class="profile-last-team__name">'.concat(l(e.name),'</span>\n                                <span class="profile-last-team__role">').concat(l(e.role),"</span>\n                            </div>\n                        ")}).join(""),"\n                    </div>\n                </div>\n            ")),e.recentBattles.length>0?i+='\n                <div class="profile-popup__section">\n                    <h3 class="profile-popup__subtitle">\n                        <i class="fas fa-shield-alt" aria-hidden="true"></i> Historique\n                    </h3>\n                    <div class="profile-history">\n                        '.concat(e.recentBattles.map(function(e){return'\n                            <a href="/arena/replay/'.concat(parseInt(e.id,10),'" class="profile-history__entry ').concat(t(e.result),'">\n                                <span class="profile-history__result">').concat(a(e.result),'</span>\n                                <span class="profile-history__opponent">vs ').concat(l(e.opponent),'</span>\n                                <span class="profile-history__type">').concat(l(e.matchType).toUpperCase(),'</span>\n                                <span class="profile-history__date">').concat(l(e.date),'</span>\n                                <i class="fas fa-play profile-history__replay" aria-hidden="true"></i>\n                            </a>\n                        ')}).join(""),"\n                    </div>\n                </div>\n            "):i+='\n                <div class="profile-popup__section">\n                    <p class="profile-popup__empty">Aucun combat enregistré</p>\n                </div>\n            ',i+='\n            <div class="profile-popup__actions">\n                <a href="/profile" class="profile-popup__edit-link">\n                    <i class="fas fa-pen" aria-hidden="true"></i> Éditer le profil\n                </a>\n            </div>\n        ',s.innerHTML=i}(e)}).catch(function(){s.innerHTML='<p class="profile-popup__error">Erreur de chargement</p>'})}),n.addEventListener("click",r),a.addEventListener("click",r)}function r(){t.classList.remove("profile-popup--open"),a.classList.remove("profile-popup__backdrop--open"),setTimeout(function(){t.style.display="none",a.style.display="none"},300)}})},6(){function e(e){var t=document.createElement("div");return t.textContent=e,t.innerHTML}document.addEventListener("DOMContentLoaded",function(){var t=document.querySelector("[data-friends-toggle]"),a=document.querySelector("[data-friends-panel]"),n=document.querySelector("[data-friends-backdrop]"),s=document.querySelector("[data-friends-close]"),i=document.querySelector("[data-friends-badge]");if(t&&a){var r=!1,c=null,o=0,l=null,d=!1,u=!1;t.addEventListener("click",function(){return r?v():(a.style.display="flex",n.style.display="block",a.offsetHeight,a.classList.add("friends-panel--open"),n.classList.add("friends-panel__backdrop--open"),r=!0,void(d||_()))}),s.addEventListener("click",v),n.addEventListener("click",v),document.querySelectorAll("[data-friends-tab]").forEach(function(e){e.addEventListener("click",function(){b(e.dataset.friendsTab)})});var p=document.querySelector("[data-friends-search-input]"),h=document.querySelector("[data-friends-search-results]"),f=null;p&&p.addEventListener("input",function(){clearTimeout(f);var t=p.value.trim();t.length<2?h.innerHTML="":f=setTimeout(function(){fetch("/friends/search?q=".concat(encodeURIComponent(t)),{headers:{"X-Requested-With":"XMLHttpRequest"}}).then(function(e){return e.json()}).then(function(t){0!==t.users.length?(h.innerHTML=t.users.map(function(t){var a="";return a="accepted"===t.friendStatus?'<span class="friend-action friend-action--pending">Ami</span>':"pending_sent"===t.friendStatus?'<span class="friend-action friend-action--pending">Envoyee</span>':"pending_received"===t.friendStatus?'<span class="friend-action friend-action--pending">Recue</span>':'<button class="friend-action friend-action--add" data-add-friend-id="'.concat(t.userId,'">\n                                <i class="fas fa-plus"></i>\n                            </button>'),'\n                            <div class="friend-item">\n                                <div class="friend-item__avatar">\n                                    '.concat(t.profileImage?'<img src="'.concat(e(t.profileImage),'" alt="').concat(e(t.username),'">'):'<i class="fas fa-user"></i>','\n                                </div>\n                                <div class="friend-item__info">\n                                    <span class="friend-item__name">').concat(e(t.username),'</span>\n                                    <span class="friend-item__rating"><i class="fas fa-trophy"></i> ').concat(t.rating,'</span>\n                                </div>\n                                <div class="friend-item__actions">').concat(a,"</div>\n                            </div>\n                        ")}).join(""),h.querySelectorAll("[data-add-friend-id]").forEach(function(e){e.addEventListener("click",function(t){t.stopPropagation(),function(e,t){t.disabled=!0,fetch("/friends/request/".concat(e),{method:"POST",headers:{"X-Requested-With":"XMLHttpRequest"}}).then(function(e){return e.json()}).then(function(e){e.success?t.outerHTML='<span class="friend-action friend-action--pending">Envoyee</span>':t.disabled=!1}).catch(function(){t.disabled=!1})}(e.dataset.addFriendId,e)})})):h.innerHTML='<p class="friends-panel__empty">Aucun guerrier trouve</p>'})},300)});var m=document.querySelector("[data-conversation-send]"),y=document.querySelector("[data-conversation-input]");m&&y&&(m.addEventListener("click",L),y.addEventListener("keydown",function(e){"Enter"===e.key&&L()}));var g=document.querySelector("[data-conversation-back]");g&&g.addEventListener("click",function(){c=null,C(),d=!1,b("friends")}),E(),setInterval(E,3e4)}function v(){a.classList.remove("friends-panel--open"),n.classList.remove("friends-panel__backdrop--open"),r=!1,C(),setTimeout(function(){a.style.display="none",n.style.display="none"},300)}function b(e){document.querySelectorAll("[data-friends-tab]").forEach(function(t){t.classList.toggle("friends-panel__tab--active",t.dataset.friendsTab===e)}),document.querySelectorAll("[data-tab-content]").forEach(function(t){t.style.display=t.dataset.tabContent===e?"block":"none"}),document.querySelector(".friends-panel__tabs").style.display="flex",document.querySelector(".friends-panel__content").style.display="block",document.querySelector("[data-friends-conversation]").style.display="none",C(),"friends"!==e||d||_(),"requests"!==e||u||k()}function _(){var t=document.querySelector('[data-tab-content="friends"]');t.innerHTML='<div class="friends-panel__loading"><i class="fas fa-spinner fa-spin"></i> Chargement...</div>',fetch("/friends/list",{headers:{"X-Requested-With":"XMLHttpRequest"}}).then(function(e){return e.json()}).then(function(a){d=!0,0!==a.friends.length?(t.innerHTML=a.friends.map(function(t){return'\n                <div class="friend-item" data-friend-user-id="'.concat(t.userId,'">\n                    <div class="friend-item__avatar">\n                        ').concat(t.profileImage?'<img src="'.concat(e(t.profileImage),'" alt="').concat(e(t.username),'">'):'<i class="fas fa-user"></i>','\n                    </div>\n                    <div class="friend-item__info">\n                        <span class="friend-item__name">').concat(e(t.username),'</span>\n                        <span class="friend-item__preview">\n                            ').concat(t.lastMessage?(t.lastMessage.isFromMe?"Vous: ":"")+e(t.lastMessage.content):"Aucun message",'\n                        </span>\n                    </div>\n                    <span class="friend-item__rating"><i class="fas fa-trophy"></i> ').concat(t.rating,"</span>\n                </div>\n            ")}).join(""),t.querySelectorAll(".friend-item").forEach(function(e){e.addEventListener("click",function(){!function(e,t){c=e,o=0,document.querySelector(".friends-panel__tabs").style.display="none",document.querySelector(".friends-panel__content").style.display="none",document.querySelector("[data-friends-conversation]").style.display="flex",document.querySelector("[data-conversation-name]").textContent=t,document.querySelector("[data-conversation-messages]").innerHTML='<div class="friends-panel__loading"><i class="fas fa-spinner fa-spin"></i> Chargement...</div>',fetch("/friends/messages/".concat(e),{headers:{"X-Requested-With":"XMLHttpRequest"}}).then(function(e){return e.json()}).then(function(e){T(e.messages,!1),C(),l=setInterval(function(){c&&fetch("/friends/messages/".concat(c,"?afterId=").concat(o),{headers:{"X-Requested-With":"XMLHttpRequest"}}).then(function(e){return e.json()}).then(function(e){e.messages&&e.messages.length>0&&T(e.messages,!0)})},5e3)})}(parseInt(e.dataset.friendUserId),e.querySelector(".friend-item__name").textContent)})})):t.innerHTML='<p class="friends-panel__empty"><i class="fas fa-ghost"></i> Aucun compagnon... Le donjon est solitaire.</p>'}).catch(function(){t.innerHTML='<p class="friends-panel__empty">Erreur de chargement</p>'})}function k(){var t=document.querySelector('[data-tab-content="requests"]');t.innerHTML='<div class="friends-panel__loading"><i class="fas fa-spinner fa-spin"></i> Chargement...</div>',fetch("/friends/pending",{headers:{"X-Requested-With":"XMLHttpRequest"}}).then(function(e){return e.json()}).then(function(a){u=!0,0!==a.requests.length?(t.innerHTML=a.requests.map(function(t){return'\n                <div class="friend-item" data-request-id="'.concat(t.friendshipId,'">\n                    <div class="friend-item__avatar">\n                        ').concat(t.profileImage?'<img src="'.concat(e(t.profileImage),'" alt="').concat(e(t.username),'">'):'<i class="fas fa-user"></i>','\n                    </div>\n                    <div class="friend-item__info">\n                        <span class="friend-item__name">').concat(e(t.username),'</span>\n                        <span class="friend-item__preview">').concat(e(t.date),'</span>\n                    </div>\n                    <div class="friend-item__actions">\n                        <button class="friend-action friend-action--accept" data-accept-id="').concat(t.friendshipId,'">\n                            <i class="fas fa-check"></i>\n                        </button>\n                        <button class="friend-action friend-action--reject" data-reject-id="').concat(t.friendshipId,'">\n                            <i class="fas fa-times"></i>\n                        </button>\n                    </div>\n                </div>\n            ')}).join(""),t.querySelectorAll("[data-accept-id]").forEach(function(e){e.addEventListener("click",function(t){t.stopPropagation(),S(e.dataset.acceptId,"accept")})}),t.querySelectorAll("[data-reject-id]").forEach(function(e){e.addEventListener("click",function(t){t.stopPropagation(),S(e.dataset.rejectId,"reject")})})):t.innerHTML='<p class="friends-panel__empty">Aucune demande en attente</p>'}).catch(function(){t.innerHTML='<p class="friends-panel__empty">Erreur de chargement</p>'})}function S(e,t){fetch("/friends/".concat(t,"/").concat(e),{method:"POST",headers:{"X-Requested-With":"XMLHttpRequest"}}).then(function(e){return e.json()}).then(function(e){e.success&&(d=!1,u=!1,k(),E())})}function T(t,a){var n=document.querySelector("[data-conversation-messages]");if(a||(0===t.length?n.innerHTML='<p class="friends-panel__empty">Debut de la conversation. Envoyez le premier message!</p>':n.innerHTML=""),a&&t.length>0){var s=n.querySelector(".friends-panel__empty");s&&s.remove()}t.forEach(function(t){t.id>o&&(o=t.id);var a=document.createElement("div");a.classList.add("chat-message",t.isFromMe?"chat-message--mine":"chat-message--theirs");var s="";t.isFromMe||(s='<button class="chat-message__report" data-report-msg-id="'.concat(t.id,'" title="Signaler ce message"><i class="fas fa-flag"></i></button>')),a.innerHTML="\n                ".concat(e(t.content),'\n                <span class="chat-message__time">').concat(e(t.date)," ").concat(s,"</span>\n            ");var i=a.querySelector("[data-report-msg-id]");i&&i.addEventListener("click",function(e){var t,a,n;e.stopPropagation(),t=i.dataset.reportMsgId,a=i,null!==(n=prompt("Raison du signalement :"))&&(a.disabled=!0,fetch("/friends/messages/".concat(t,"/report"),{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({reason:n})}).then(function(e){return e.json()}).then(function(e){e.success?(a.innerHTML='<i class="fas fa-check"></i>',a.classList.add("chat-message__report--done"),a.title="Signale"):a.disabled=!1}).catch(function(){a.disabled=!1}))}),n.appendChild(a)}),n.scrollTop=n.scrollHeight}function L(){var e=y.value.trim();e&&c&&(y.value="",fetch("/friends/messages/".concat(c),{method:"POST",headers:{"Content-Type":"application/json","X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({content:e})}).then(function(e){return e.json()}).then(function(e){e.success&&e.message&&T([e.message],!0)}))}function C(){l&&(clearInterval(l),l=null)}function E(){fetch("/friends/unread-count",{headers:{"X-Requested-With":"XMLHttpRequest"}}).then(function(e){return e.json()}).then(function(e){e.total>0?(i.textContent=e.total,i.style.display="inline-block"):i.style.display="none";var t=document.querySelector("[data-requests-badge]");t&&(e.pendingRequests>0?(t.textContent=e.pendingRequests,t.style.display="inline-block"):t.style.display="none")}).catch(function(){})}})}},e=>{e.O(0,[785],()=>{return t=563,e(e.s=t);var t});e.O()}]);