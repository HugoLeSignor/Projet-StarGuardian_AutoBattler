{% extends 'base.html.twig' %}

{% block title %}{{ 'teams.title'|trans }}{% endblock %}

{% block body %}
<div class="teams-page">
    <div class="teams-page__vignette"></div>

    {# ====== HEADER + EQUIPE SELECTIONNEE ====== #}
    <a href="{{ path('app_home') }}" class="teams-page__back">
        <i class="fas fa-arrow-left"></i> {{ 'teams.back'|trans }}
    </a>

    <div class="selected-team">
        <h3 class="selected-team__title">{{ 'teams.compose_team'|trans }}</h3>
        <div class="role-indicator">
            <div class="role-slot" data-role="Tank">
                <i class="fas fa-shield-alt"></i>
                <span>Tank</span>
            </div>
            <div class="role-slot" data-role="DPS">
                <i class="fas fa-crosshairs"></i>
                <span>DPS</span>
            </div>
            <div class="role-slot" data-role="Support">
                <i class="fas fa-heart"></i>
                <span>Support</span>
            </div>
        </div>
        <div class="selected-list"></div>

        <div class="selected-team__actions">
            <button class="btn-launch" disabled>{{ 'teams.launch'|trans }}</button>
            <button class="btn-save-preset" disabled title="{{ 'teams.save_team'|trans }}">
                <i class="fas fa-star"></i> {{ 'teams.save_team'|trans }}
            </button>
        </div>
    </div>

    {# ====== PRESETS ====== #}
    {% if presets is defined and presets|length > 0 %}
    <div class="presets-bar">
        <span class="presets-bar__label"><i class="fas fa-bookmark"></i> {{ 'teams.presets'|trans }}</span>
        <div class="presets-bar__list">
            {% for preset in presets %}
                <div class="preset-chip" data-preset-id="{{ preset.id }}" data-preset-ids="{{ preset.characterIds|json_encode }}">
                    <span class="preset-chip__name">{{ preset.name }}</span>
                    <button class="preset-chip__load" title="{{ 'teams.load_preset'|trans }}">
                        <i class="fas fa-play"></i>
                    </button>
                    <button class="preset-chip__delete" title="{{ 'teams.delete_preset'|trans }}">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    {# ====== LAYOUT 2 COLONNES ====== #}
    <div class="teams-layout">

        {# ===== GRILLE PORTRAITS (GAUCHE) ===== #}
        <div class="team-grid">
            {% for catName, category in categories %}
            {% if category.characters|length > 0 %}
                <div class="team-grid__category-header">
                    <i class="fas {{ category.icon }}"></i>
                    <span>{{ catName }}</span>
                </div>
                {% for hero in category.characters %}
                <div class="team-portrait"
                    data-id="{{ hero.id }}"
                    data-name="{{ hero.name }}"
                    data-role="{{ hero.role ? hero.role.name : '' }}"
                    data-dmg-min="{{ hero.DMGMIN }}"
                    data-dmg-max="{{ hero.DMGMAX }}"
                    data-speed="{{ hero.SPEED }}"
                    data-dodge="{{ hero.DODGE }}"
                    data-crit="{{ hero.CRIT }}"
                    data-hp="{{ hero.HP }}"
                    data-sprite="{{ (hero.name is not empty ? hero.name|lower|replace({' ':'-', '_':'-'}) : 'inconnu') ~ '-idle.gif' }}"
                    data-ability-name="{{ hero.ability ? hero.ability.name : '' }}"
                    data-ability-desc="{{ hero.ability ? hero.ability.description : '' }}"
                    data-ability-cd="{{ hero.ability ? hero.ability.cooldown : '' }}">
                    <img src="{{ asset('asset/img/' ~ (hero.name is not empty ? hero.name|lower|replace({' ':'-', '-':'-'}) : 'inconnu') ~ '.webp') }}" alt="{{ hero.name }}" loading="lazy" width="150" height="150">
                    <span>{{ hero.name }}</span>
                </div>
                {% endfor %}
            {% endif %}
            {% endfor %}
        </div>

        {# ===== DETAILS PERSONNAGE (DROITE) ===== #}
        <div class="team-details" id="teamDetails">
            <div class="team-placeholder" id="spriteDetails">
                <div class="team-placeholder__icon">
                    <i class="fas fa-hand-pointer"></i>
                </div>
                <h2>{{ 'teams.select_hero'|trans }}</h2>
                <p>{{ 'teams.select_hero_hint'|trans }}</p>
            </div>
        </div>

    </div>
</div>

{# ====== MODAL SAVE PRESET ====== #}
<div class="preset-modal" id="presetModal" style="display:none;">
    <div class="preset-modal__backdrop"></div>
    <div class="preset-modal__panel">
        <h3 class="preset-modal__title">
            <i class="fas fa-star"></i> {{ 'teams.save_team_title'|trans }}
        </h3>
        <input type="text" class="preset-modal__input" id="presetName"
               placeholder="{{ 'teams.preset_name_placeholder'|trans }}" maxlength="50" autocomplete="off">
        <div class="preset-modal__actions">
            <button class="btn-dd btn-dd--secondary" id="presetCancel">{{ 'common.cancel'|trans }}</button>
            <button class="btn-dd btn-dd--primary" id="presetConfirm">{{ 'common.save'|trans }}</button>
        </div>
    </div>
</div>
{% endblock %}
