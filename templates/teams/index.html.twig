{% extends 'base.html.twig' %}

{% block title %}Composition d'&eacute;quipe{% endblock %}

{% block body %}
<div class="teams-page" data-synergy-map="{{ synergyMap|default('{}')|e('html_attr') }}">
    <div class="teams-page__vignette"></div>

    {# ====== HEADER + EQUIPE SELECTIONNEE ====== #}
    <a href="{{ path('app_home') }}" class="teams-page__back">
        <i class="fas fa-arrow-left"></i> Retour
    </a>

    <div class="selected-team">
        <h3 class="selected-team__title">Composez votre &eacute;quipe</h3>
        <div class="role-indicator">
            <div class="role-slot" data-role="Tank">
                <i class="fas fa-shield-alt"></i>
                <span>Tank</span>
            </div>
            <div class="role-slot" data-role="DPS">
                <i class="fas fa-crosshairs"></i>
                <span>DPS</span>
            </div>
            <div class="role-slot" data-role="Healer">
                <i class="fas fa-hand-holding-medical"></i>
                <span>Healer</span>
            </div>
            <div class="role-slot" data-role="Support">
                <i class="fas fa-chess-rook"></i>
                <span>Support</span>
            </div>
        </div>
        <div class="selected-list"></div>

        <div class="selected-team__actions">
            <button class="btn-launch" disabled>Lancer la partie</button>
            <button class="btn-save-preset" disabled title="Sauvegarder cette &eacute;quipe">
                <i class="fas fa-star"></i> Sauvegarder
            </button>
        </div>
    </div>

    {# ====== PRESETS ====== #}
    {% if presets is defined and presets|length > 0 %}
    <div class="presets-bar">
        <span class="presets-bar__label"><i class="fas fa-bookmark"></i> Presets :</span>
        <div class="presets-bar__list">
            {% for preset in presets %}
                <div class="preset-chip" data-preset-id="{{ preset.id }}" data-preset-ids="{{ preset.characterIds|json_encode }}">
                    <span class="preset-chip__name">{{ preset.name }}</span>
                    <button class="preset-chip__load" title="Charger ce preset">
                        <i class="fas fa-play"></i>
                    </button>
                    <button class="preset-chip__delete" title="Supprimer ce preset">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    {# ====== LAYOUT 2 COLONNES ====== #}
    <div class="teams-layout">

        {# ===== GRILLE PORTRAITS (GAUCHE) ===== #}
        {% set categoryMap = {'Tanks': 'Tank', 'DPS': 'DPS', 'Healers': 'Healer', 'Supports': 'Support'} %}
        <div class="team-grid">
            {% for catName, category in categories %}
            {% if category.characters|length > 0 %}
                <div class="team-grid__category-header">
                    <i class="fas {{ category.icon }}"></i>
                    <span>{{ catName }}</span>
                </div>
                {% for hero in category.characters %}
                <div class="team-portrait"
                    data-id="{{ hero.id }}"
                    data-name="{{ hero.name }}"
                    data-role="{{ hero.role ? hero.role.name : '' }}"
                    data-category="{{ categoryMap[catName]|default('Support') }}"
                    data-dmg-min="{{ hero.DMGMIN }}"
                    data-dmg-max="{{ hero.DMGMAX }}"
                    data-speed="{{ hero.SPEED }}"
                    data-dodge="{{ hero.DODGE }}"
                    data-crit="{{ hero.CRIT }}"
                    data-hp="{{ hero.HP }}"
                    data-sprite="{{ (hero.name is not empty ? hero.name|lower|replace({' ':'-', '_':'-'}) : 'inconnu') ~ '-idle.gif' }}"
                    data-ability-name="{{ hero.ability ? hero.ability.name : '' }}"
                    data-ability-desc="{{ hero.ability ? hero.ability.description : '' }}"
                    data-ability-cd="{{ hero.ability ? hero.ability.cooldown : '' }}">
                    <img src="{{ asset('asset/img/' ~ (hero.name is not empty ? hero.name|lower|replace({' ':'-', '-':'-'}) : 'inconnu') ~ '.webp') }}" alt="{{ hero.name }}" loading="lazy">
                    <span>{{ hero.name }}</span>
                </div>
                {% endfor %}
            {% endif %}
            {% endfor %}
        </div>

        {# ===== DETAILS PERSONNAGE (DROITE) ===== #}
        <div class="team-details" id="teamDetails">
            <div class="team-placeholder" id="spriteDetails">
                <div class="team-placeholder__icon">
                    <i class="fas fa-hand-pointer"></i>
                </div>
                <h2>S&eacute;lectionnez un h&eacute;ros</h2>
                <p>Cliquez sur un portrait pour afficher ses informations.</p>
            </div>
        </div>

    </div>
</div>

{# ====== MODAL SAVE PRESET ====== #}
<div class="preset-modal" id="presetModal" style="display:none;">
    <div class="preset-modal__backdrop"></div>
    <div class="preset-modal__panel">
        <h3 class="preset-modal__title">
            <i class="fas fa-star"></i> Sauvegarder l'&eacute;quipe
        </h3>
        <input type="text" class="preset-modal__input" id="presetName"
               placeholder="Nom du preset..." maxlength="50" autocomplete="off">
        <div class="preset-modal__actions">
            <button class="btn-dd btn-dd--secondary" id="presetCancel">Annuler</button>
            <button class="btn-dd btn-dd--primary" id="presetConfirm">Sauvegarder</button>
        </div>
    </div>
</div>
{% endblock %}
