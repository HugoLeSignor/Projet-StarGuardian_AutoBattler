{% extends 'base.html.twig' %}

{% block title %}Admin - Signalements{% endblock %}

{% block body %}
<div class="admin-page">
    <div class="admin-page__vignette"></div>

    <div class="admin-header">
        <h1 class="admin-header__title"><i class="fas fa-crown"></i> Panel d'Administration</h1>
        <nav class="admin-nav">
            <a href="{{ path('app_admin') }}" class="admin-nav__link">
                <i class="fas fa-tachometer-alt"></i> Dashboard
            </a>
            <a href="{{ path('app_admin_users') }}" class="admin-nav__link">
                <i class="fas fa-users"></i> Utilisateurs
            </a>
            <a href="{{ path('app_admin_reports') }}" class="admin-nav__link admin-nav__link--active">
                <i class="fas fa-flag"></i> Signalements
                {% if reportedMessages|length > 0 %}
                    <span class="admin-nav__badge">{{ reportedMessages|length }}</span>
                {% endif %}
            </a>
            <a href="{{ path('app_admin_unban_requests') }}" class="admin-nav__link">
                <i class="fas fa-unlock"></i> D&eacute;ban
            </a>
        </nav>
    </div>

    <div class="admin-section">
        <h2 class="admin-section__title"><i class="fas fa-flag"></i> Messages signal&eacute;s ({{ reportedMessages|length }})</h2>

        {% if reportedMessages|length > 0 %}
            <table class="admin-table">
                <thead>
                    <tr>
                        <th>Auteur</th>
                        <th>Destinataire</th>
                        <th>Message</th>
                        <th>Signal&eacute; par</th>
                        <th>Raison</th>
                        <th>Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for msg in reportedMessages %}
                        <tr>
                            <td>
                                <a href="{{ path('app_admin_user_detail', {id: msg.sender.id}) }}" class="admin-link">
                                    {{ msg.sender.username }}
                                </a>
                            </td>
                            <td>{{ msg.receiver.username }}</td>
                            <td class="admin-table__msg">{{ msg.content }}</td>
                            <td>{{ msg.reportedBy ? msg.reportedBy.username : '?' }}</td>
                            <td class="admin-table__muted">{{ msg.reportReason|default('Non specifiee') }}</td>
                            <td class="admin-table__muted">{{ msg.reportedAt ? msg.reportedAt|date('d/m/Y H:i') : '?' }}</td>
                            <td class="admin-table__actions">
                                <form method="POST" action="{{ path('app_admin_report_remove', {id: msg.id}) }}" style="display:inline;">
                                    <button type="submit" class="admin-btn admin-btn--danger admin-btn--small"
                                            title="Supprimer le message"
                                            onclick="return confirm('Supprimer ce message ?')">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </form>
                                <form method="POST" action="{{ path('app_admin_report_dismiss', {id: msg.id}) }}" style="display:inline;">
                                    <button type="submit" class="admin-btn admin-btn--small"
                                            title="Rejeter le signalement">
                                        <i class="fas fa-check"></i>
                                    </button>
                                </form>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p class="admin-empty"><i class="fas fa-check-circle"></i> Aucun signalement en attente. Tout est calme dans le donjon.</p>
        {% endif %}
    </div>
</div>
{% endblock %}
